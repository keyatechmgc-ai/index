<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®Ø·ÙˆØ¨Ø© - Ù†Ø³Ø®Ø© Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø´Ø§Ù…Ù„</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --main: #ff4d6d; }
        body { font-family: sans-serif; background: #fff0f3; text-align: center; color: #590d22; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); max-width: 450px; margin: auto; }
        .countdown { display: flex; justify-content: center; gap: 10px; margin: 20px 0; }
        .box { background: #fff; padding: 10px; border-radius: 10px; border: 1px solid var(--main); min-width: 50px; }
        input, textarea { width: 90%; padding: 10px; margin: 10px 0; border-radius: 10px; border: 1px solid #ddd; }
        button { background: var(--main); color: white; border: none; padding: 12px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; width: 100%; margin: 5px 0; }
        #admin-panel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 9999; padding: 20px; overflow-y: auto; box-sizing: border-box; }
        .comment-item { background: #f9f9f9; padding: 10px; margin: 5px 0; border-radius: 8px; border-right: 4px solid var(--main); text-align: right; }
        .couple-img { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; display: none; margin: 10px auto; border: 3px solid var(--main); }
    </style>
</head>
<body>

<div class="card">
    <img id="mainImage" src="" class="couple-img">
    <h2>ğŸ’ Ø®Ø·ÙˆØ¨ØªÙ†Ø§ Ø§Ù„Ø³Ø¹ÙŠØ¯Ø©</h2>
    <div class="countdown">
        <div class="box"><span id="days">0</span><br>ÙŠÙˆÙ…</div>
        <div class="box"><span id="hours">0</span><br>Ø³Ø§Ø¹Ø©</div>
        <div class="box"><span id="minutes">0</span><br>Ø¯Ù‚ÙŠÙ‚Ø©</div>
        <div class="box" onclick="adminAuth()" style="cursor:pointer"><span id="seconds">0</span><br>Ø«Ø§Ù†ÙŠØ©</div>
    </div>
    <div style="text-align: right;">
        <input type="text" id="userName" placeholder="Ø§Ø³Ù…Ùƒ">
        <textarea id="userMsg" placeholder="ØªÙ‡Ù†Ø¦ØªÙƒ..."></textarea>
        <button onclick="sendComment()">Ø¥Ø±Ø³Ø§Ù„ â¤ï¸</button>
    </div>
    <div id="commentsList"></div>
</div>

<div id="admin-panel">
    <h3>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h3>
    <input type="datetime-local" id="targetDate">
    <input type="text" id="imgUrl" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±">
    <button onclick="testConnection()" style="background: orange;">1. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨ÙØ§ÙŠØ±Ø¨ÙŠØ²</button>
    <button onclick="updateSettings()" style="background: green;">2. Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    <button onclick="document.getElementById('admin-panel').style.display='none'" style="background: gray;">Ø¥ØºÙ„Ø§Ù‚</button>
    <hr>
    <div id="adminComments"></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCF-kh6JgAbhroue7cKRdMZjwYV8m2c6Uw",
        authDomain: "engagmen.firebaseapp.com",
        databaseURL: "https://engagmen-default-rtdb.firebaseio.com",
        projectId: "engagmen",
        storageBucket: "engagmen.firebasestorage.app",
        messagingSenderId: "286100738965",
        appId: "1:286100738965:web:3f5be0307dca5927e5dc9c"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let clicks = 0;
    function adminAuth() { clicks++; if(clicks>=10) { document.getElementById('admin-panel').style.display='block'; clicks=0; } }

    let tTime = 0;

    // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ (Ø²Ø± Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØªØ´Ø®ÙŠØµ)
    function testConnection() {
        db.ref('connection_test').set(Date.now())
            .then(() => alert("Ø§ØªØµØ§Ù„ ÙØ§ÙŠØ±Ø¨ÙŠØ² Ù†Ø§Ø¬Ø­! Ø¬Ø±Ø¨ Ø§Ù„Ø¢Ù† Ø§Ù„Ø­ÙØ¸."))
            .catch(e => alert("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: " + e.message));
    }

    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    db.ref('settings').on('value', s => {
        const v = s.val();
        if(v) {
            if(v.date) { tTime = new Date(v.date).getTime(); document.getElementById('targetDate').value = v.date; }
            if(v.image) { document.getElementById('mainImage').src = v.image; document.getElementById('mainImage').style.display='block'; }
        }
    });

    // Ø§Ù„Ø­ÙØ¸ (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ­Ø¯ÙŠØ« ÙˆÙ„ÙŠØ³ ØªØ¹ÙŠÙŠÙ† ÙƒÙ„ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø±)
    function updateSettings() {
        const d = document.getElementById('targetDate').value;
        const i = document.getElementById('imgUrl').value;
        if(!d) return alert("Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®!");

        db.ref('settings').update({ date: d, image: i })
            .then(() => alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!"))
            .catch(e => alert("Ø®Ø·Ø£: " + e.message));
    }

    // Ø§Ù„Ø¹Ø¯Ø§Ø¯
    setInterval(() => {
        const diff = tTime - Date.now();
        if(diff <= 0) return;
        document.getElementById('days').innerText = Math.floor(diff/(1000*60*60*24));
        document.getElementById('hours').innerText = Math.floor((diff%(1000*60*60*24))/(1000*60*60));
        document.getElementById('minutes').innerText = Math.floor((diff%(1000*60*60))/(1000*60));
        document.getElementById('seconds').innerText = Math.floor((diff%(1000*60))/1000);
    }, 1000);

    // Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
    function sendComment() {
        const n = document.getElementById('userName').value;
        const m = document.getElementById('userMsg').value;
        if(n && m) db.ref('comments').push({ name: n, msg: m });
    }

    db.ref('comments').on('value', s => {
        const list = document.getElementById('commentsList');
        const adm = document.getElementById('adminComments');
        list.innerHTML = ''; adm.innerHTML = '';
        s.forEach(c => {
            list.innerHTML += `<div class="comment-item"><b>${c.val().name}:</b> ${c.val().msg}</div>`;
            adm.innerHTML += `<div class="comment-item"><button onclick="db.ref('comments/${c.key}').remove()">Ø­Ø°Ù</button> ${c.val().name}</div>`;
        });
    });
</script>
</body>
</html>
