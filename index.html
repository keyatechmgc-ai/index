<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­ÙÙ„ Ø®Ø·ÙˆØ¨Ø© | M & E</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Great+Vibes&family=Amiri:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { --pink: #ff85a2; --gold: #c5a059; --dark: #4a0e0e; }
        body { font-family: 'Cairo', sans-serif; background: #fff5f7; margin: 0; color: var(--dark); text-align: center; }
        
        /* Ø§Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„ÙˆØ±Ø¯ */
        .rose { position: fixed; top: -10%; z-index: 999; pointer-events: none; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); opacity: 0; } }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header { background: white; padding: 30px 10px; border-bottom: 4px solid var(--gold); border-radius: 0 0 40px 40px; }
        .main-names { font-family: 'Great Vibes', cursive; font-size: 4rem; color: var(--pink); margin: 0; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
        .couple-img { width: 220px; height: 220px; border-radius: 50%; border: 5px solid var(--gold); object-fit: cover; margin: 15px auto; display: none; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }

        /* ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø© */
        .event-info { background: white; margin: 20px auto; width: 90%; padding: 20px; border-radius: 20px; border: 1px dashed var(--gold); }
        .location-btn { display: inline-block; padding: 8px 20px; background: #4285F4; color: white; text-decoration: none; border-radius: 10px; margin-top: 10px; font-size: 14px; }

        /* Ø§Ù„Ø¹Ø¯Ø§Ø¯ */
        .timer { display: flex; justify-content: center; gap: 10px; margin-top: -30px; }
        .unit { background: white; padding: 10px; border-radius: 15px; min-width: 60px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border: 1px solid var(--pink); }
        .unit span { display: block; font-size: 22px; font-weight: bold; color: var(--pink); }

        /* Ø§Ù„ÙƒØ±ÙˆØª ÙˆØ§Ù„Ù…Ø¯Ø®Ù„Ø§Øª */
        .card { width: 90%; max-width: 500px; margin: 30px auto; background: white; padding: 25px; border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.05); box-sizing: border-box; }
        input, textarea, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 12px; border: 1px solid #ddd; box-sizing: border-box; font-family: 'Cairo'; }
        .side-box { display: flex; gap: 10px; margin-bottom: 10px; }
        .side-btn { flex: 1; padding: 10px; border: 2px solid var(--pink); border-radius: 10px; cursor: pointer; font-weight: bold; }
        .side-btn.active { background: var(--pink); color: white; }

        /* Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª */
        .comment-item { text-align: right; background: #fff9fa; padding: 15px; border-radius: 15px; margin-bottom: 15px; border-right: 5px solid var(--pink); display: flex; align-items: center; gap: 15px; }
        .user-avatar { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid var(--pink); }

        /* Ø§Ù„Ø£Ø¯Ù…Ù† */
        #admin-panel { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:9999; padding:20px; overflow-y:auto; box-sizing: border-box; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-card { background: #fdf0f2; padding: 15px; border-radius: 10px; }
    </style>
</head>
<body>

<div class="header">
    <h1 class="main-names">M & E</h1>
    <img id="displayImg" class="couple-img">
    <div id="eventDetails" class="event-info">
        <b id="hallName">Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¹Ø©</b> <br>
        ğŸ“… <span id="eventDay">Ø§Ù„ÙŠÙˆÙ…</span> | ğŸ•’ <span id="eventTime">Ø§Ù„Ø³Ø§Ø¹Ø©</span> <br>
        <span id="eventNotes" style="font-size: 13px; color: #666;"></span> <br>
        <a id="locLink" href="#" target="_blank" class="location-btn">ğŸ“ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù‚Ø§Ø¹Ø©</a>
    </div>
</div>

<div class="timer">
    <div class="unit"><span id="days">00</span>ÙŠÙˆÙ…</div>
    <div class="unit"><span id="hours">00</span>Ø³Ø§Ø¹Ø©</div>
    <div class="unit"><span id="minutes">00</span>Ø¯Ù‚ÙŠÙ‚Ø©</div>
    <div class="unit" onclick="adminAuth()" style="cursor:pointer"><span id="seconds">00</span>Ø«Ø§Ù†ÙŠØ©</div>
</div>

<div class="card">
    <h3>ØªÙ‡Ù†Ø¦Ø© ÙˆØ­Ø¶ÙˆØ± â¤ï¸</h3>
    <input type="text" id="gName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ±ÙŠÙ…">
    
    <div class="side-box">
        <div class="side-btn" onclick="setSide(this, 'Ø§Ù„Ø¹Ø±ÙŠØ³')">ğŸ¤µ Ø§Ù„Ø¹Ø±ÙŠØ³</div>
        <div class="side-btn" onclick="setSide(this, 'Ø§Ù„Ø¹Ø±ÙˆØ³Ø©')">ğŸ‘° Ø§Ù„Ø¹Ø±ÙˆØ³Ø©</div>
    </div>

    <select id="gStatus">
        <option value="">Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¶ÙˆØ±...</option>
        <option value="Ø­Ø§Ø¶Ø±">Ø³Ø£ÙƒÙˆÙ† Ù…Ù† Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ†</option>
        <option value="ÙŠØ­Ø§ÙˆÙ„">Ø³Ø£Ø¨Ø°Ù„ Ø¬Ù‡Ø¯ÙŠ Ù„Ù„ØªØ´Ø±ÙŠÙ</option>
        <option value="Ù…Ø¹ØªØ°Ø±">Ø£Ø¹ØªØ°Ø± Ù„Ø¸Ø±ÙˆÙ Ù‚Ù‡Ø±ÙŠØ©</option>
    </select>

    <div style="font-size: 12px; text-align: right; color: var(--pink);">ØµÙˆØ±Ø© Ø¨Ø±ÙˆÙÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</div>
    <input type="file" id="userPhoto" accept="image/*" style="font-size: 12px;">

    <textarea id="gMsg" rows="2" placeholder="ÙƒÙ„Ù…Ø© Ù…Ù† Ø§Ù„Ù‚Ù„Ø¨..."></textarea>
    <button id="sendBtn" onclick="processUpload()" style="background:var(--pink); color:white; border:none; padding:15px; width:100%; border-radius:15px; font-weight:bold; cursor:pointer;">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‡Ù†Ø©</button>
    
    <div id="commentsList" style="margin-top: 30px;"></div>
</div>

<div id="admin-panel">
    <h3>âš™ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø³ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ù‚ÙŠØ¨</h3>
    <div class="stat-grid">
        <div class="stat-card">Ø§Ù„ÙƒÙ„: <b id="t1">0</b></div>
        <div class="stat-card">Ø§Ù„Ø¹Ø±ÙŠØ³: <b id="t2">0</b></div>
        <div class="stat-card">Ø§Ù„Ø¹Ø±ÙˆØ³Ø©: <b id="t3">0</b></div>
        <div class="stat-card">Ø­Ø§Ø¶Ø±: <b id="t4">0</b></div>
    </div>

    <h4>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</h4>
    <input type="datetime-local" id="setCountDate">
    <input type="text" id="setHall" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¹Ø©">
    <input type="text" id="setDay" placeholder="ÙŠÙˆÙ… Ø§Ù„Ø­ÙÙ„ (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ø®Ù…ÙŠØ³)">
    <input type="text" id="setTime" placeholder="Ø§Ù„Ø³Ø§Ø¹Ø© (Ù…Ø«Ù„Ø§Ù‹: 8 Ù…Ø³Ø§Ø¡Ù‹)">
    <input type="text" id="setLoc" placeholder="Ø±Ø§Ø¨Ø· Ø¬ÙˆØ¬Ù„ Ù…Ø§Ø¨">
    <textarea id="setNotes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©"></textarea>
    
    <div style="background: #eee; padding: 10px; border-radius: 10px; margin: 10px 0;">
        ØªØºÙŠÙŠØ± ØµÙˆØ±Ø© Ø§Ù„Ø¹Ø±ÙˆØ³ÙŠÙ†: <input type="file" id="adminFile" accept="image/*">
    </div>

    <button onclick="saveAdminSettings()" style="background:green; color:white; padding:15px; width:100%; border:none; border-radius:10px;">Ø­ÙØ¸ ÙƒÙ„ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
    <button onclick="document.getElementById('admin-panel').style.display='none'" style="margin-top:10px; width:100%;">Ø¥ØºÙ„Ø§Ù‚</button>
    
    <div id="adminDetailList" style="margin-top: 20px; text-align: right;"></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCF-kh6JgAbhroue7cKRdMZjwYV8m2c6Uw",
        authDomain: "engagmen.firebaseapp.com",
        databaseURL: "https://engagmen-default-rtdb.firebaseio.com",
        projectId: "engagmen",
        storageBucket: "engagmen.firebasestorage.app",
        messagingSenderId: "286100738965",
        appId: "1:286100738965:web:3f5be0307dca5927e5dc9c"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let selectedSide = "";
    let targetTime = 0;

    function setSide(el, s) {
        document.querySelectorAll('.side-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        selectedSide = s;
    }

    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    db.ref('settings').on('value', s => {
        const v = s.val() || {};
        if(v.date) targetTime = new Date(v.date).getTime();
        if(v.hall) document.getElementById('hallName').innerText = v.hall;
        if(v.day) document.getElementById('eventDay').innerText = v.day;
        if(v.time) document.getElementById('eventTime').innerText = v.time;
        if(v.loc) document.getElementById('locLink').href = v.loc;
        if(v.notes) document.getElementById('eventNotes').innerText = v.notes;
        if(v.image) { document.getElementById('displayImg').src = v.image; document.getElementById('displayImg').style.display = 'block'; }
    });

    // Ø§Ù„Ø¹Ø¯Ø§Ø¯
    setInterval(() => {
        const diff = targetTime - Date.now();
        if(diff <= 0) return;
        document.getElementById('days').innerText = Math.floor(diff/(1000*60*60*24));
        document.getElementById('hours').innerText = Math.floor((diff%(1000*60*60*24))/(1000*60*60));
        document.getElementById('minutes').innerText = Math.floor((diff%(1000*60*60))/(1000*60));
        document.getElementById('seconds').innerText = Math.floor((diff%(1000*60))/1000);
    }, 1000);

    // Ø¯Ø§Ù„Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ù„Ù€ ImgBB (Ù…Ø¬Ø§Ù†ÙŠØ©)
    async function uploadImg(file) {
        const formData = new FormData();
        formData.append("image", file);
        const res = await fetch("https://api.imgbb.com/1/upload?key=671239c0f991448624f2b172a6a1d48c", { method: "POST", body: formData });
        const data = await res.json();
        return data.data.url;
    }

    async function processUpload() {
        const name = document.getElementById('gName').value;
        const msg = document.getElementById('gMsg').value;
        const status = document.getElementById('gStatus').value;
        const file = document.getElementById('userPhoto').files[0];

        if(!name || !selectedSide || !status) return alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©");
        
        document.getElementById('sendBtn').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";
        let imgUrl = "https://cdn-icons-png.flaticon.com/512/1144/1144760.png"; // Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        
        if(file) imgUrl = await uploadImg(file);

        db.ref('comments').push({
            name: name, msg: msg, side: selectedSide, status: status, img: imgUrl, date: new Date().toLocaleString('ar-EG')
        }).then(() => {
            alert("Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ÙŠØ§ " + name + " Ø¹Ù„Ù‰ ØªÙ‡Ù†Ø¦ØªÙƒ Ø§Ù„Ø±Ù‚ÙŠÙ‚Ø© â¤ï¸");
            location.reload();
        });
    }

    db.ref('comments').on('value', s => {
        const list = document.getElementById('commentsList');
        const adm = document.getElementById('adminDetailList');
        list.innerHTML = ""; adm.innerHTML = "";
        let counts = { t:0, g:0, b:0, y:0 };

        s.forEach(c => {
            const d = c.val();
            counts.t++;
            if(d.side === 'Ø§Ù„Ø¹Ø±ÙŠØ³') counts.g++; else counts.b++;
            if(d.status === 'Ø­Ø§Ø¶Ø±') counts.y++;

            list.innerHTML += `<div class="comment-item">
                <img src="${d.img}" class="user-avatar">
                <div><b>${d.name}</b> <small>(${d.side})</small><br>${d.msg}</div>
            </div>`;

            adm.innerHTML += `<div style="padding:10px; border-bottom:1px solid #eee;">
                <button onclick="db.ref('comments/${c.key}').remove()" style="float:left; background:red; color:white; border:none;">Ø­Ø°Ù</button>
                <b>${d.name}</b> | ${d.status} | ${d.side}
            </div>`;
        });
        document.getElementById('t1').innerText = counts.t;
        document.getElementById('t2').innerText = counts.g;
        document.getElementById('t3').innerText = counts.b;
        document.getElementById('t4').innerText = counts.y;
    });

    let clicks = 0;
    function adminAuth() { clicks++; if(clicks>=10) { document.getElementById('admin-panel').style.display='block'; clicks=0; } }

    async function saveAdminSettings() {
        const file = document.getElementById('adminFile').files[0];
        let finalImg = document.getElementById('displayImg').src;
        if(file) finalImg = await uploadImg(file);

        db.ref('settings').update({
            date: document.getElementById('setCountDate').value,
            hall: document.getElementById('setHall').value,
            day: document.getElementById('setDay').value,
            time: document.getElementById('setTime').value,
            loc: document.getElementById('setLoc').value,
            notes: document.getElementById('setNotes').value,
            image: finalImg
        }).then(() => alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ ÙŠØ§ Ø³ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ù‚ÙŠØ¨"));
    }

    // ØªØ³Ø§Ù‚Ø· Ø§Ù„ÙˆØ±Ø¯
    setInterval(() => {
        const r = document.createElement('div');
        r.className = 'rose'; r.innerHTML = 'ğŸŒ¸';
        r.style.left = Math.random() * 100 + 'vw';
        r.style.animationDuration = (Math.random() * 2 + 3) + 's';
        document.body.appendChild(r);
        setTimeout(() => r.remove(), 5000);
    }, 700);
</script>
</body>
</html>
