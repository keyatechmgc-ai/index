<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M & E | Wedding Celebration</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Dancing+Script:wght@700&family=Lateef&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #ff85a2; --secondary: #fbb1bd; --accent: #c5a059; --text: #590d22; }
        body { font-family: 'Cairo', sans-serif; background: #fff0f3; margin: 0; color: var(--text); overflow-x: hidden; }
        
        /* Ø§Ù†ÙŠÙ…ÙŠØ´Ù† Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© */
        .bg-animate { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: linear-gradient(45deg, #fff0f3, #fbb1bd); opacity: 0.5; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ */
        .header { text-align: center; padding: 60px 20px; background: white; border-bottom-left-radius: 50% 20%; border-bottom-right-radius: 50% 20%; box-shadow: 0 10px 30px rgba(255,133,162,0.2); position: relative; }
        .couple-img { width: 280px; height: 280px; border-radius: 50%; border: 8px solid white; box-shadow: 0 0 25px rgba(0,0,0,0.1); object-fit: cover; margin-bottom: 20px; transition: 0.5s; animation: pulse 3s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        
        h1 { font-family: 'Dancing Script', cursive; font-size: 4rem; color: var(--primary); margin: 10px 0; }
        
        /* Ø§Ù„Ø¹Ø¯Ø§Ø¯ */
        .timer { display: flex; justify-content: center; gap: 15px; margin-top: -40px; }
        .unit { background: white; padding: 15px; border-radius: 20px; min-width: 70px; box-shadow: 0 8px 20px rgba(0,0,0,0.05); border: 2px solid var(--secondary); transform: rotate(-2deg); }
        .unit:nth-child(even) { transform: rotate(2deg); }
        .unit span { display: block; font-size: 26px; font-weight: bold; color: var(--primary); }

        /* Ø§Ù„ÙƒØ±ÙˆØª */
        .card { max-width: 600px; margin: 50px auto; background: rgba(255,255,255,0.9); padding: 30px; border-radius: 30px; box-shadow: 0 15px 40px rgba(0,0,0,0.05); backdrop-filter: blur(10px); }
        
        .input-group { margin-bottom: 20px; }
        input, textarea, select { width: 100%; padding: 15px; border-radius: 15px; border: 2px solid var(--secondary); background: white; font-family: 'Cairo'; box-sizing: border-box; }
        
        .option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .choice { padding: 12px; border: 2px solid var(--secondary); border-radius: 15px; cursor: pointer; text-align: center; transition: 0.3s; font-weight: bold; }
        .choice.selected { background: var(--primary); color: white; border-color: var(--primary); }

        /* ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ø¶ÙŠÙˆÙ */
        .comment { background: white; padding: 20px; border-radius: 20px; margin-bottom: 15px; position: relative; border-left: 6px solid var(--primary); transition: 0.3s; }
        .comment:hover { transform: translateX(-5px); }
        .comment-info { font-size: 12px; color: #888; display: flex; justify-content: space-between; margin-top: 10px; }
        .badge { background: var(--secondary); color: var(--text); padding: 3px 10px; border-radius: 10px; font-size: 11px; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #admin-panel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 10000; padding: 30px; overflow-y: auto; box-sizing: border-box; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-box { background: var(--secondary); padding: 15px; border-radius: 15px; text-align: center; }
        .stat-box h4 { margin: 0; font-size: 14px; }
        .stat-box p { font-size: 24px; font-weight: bold; margin: 5px 0; }

        /* Ø§Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø·Ø§Ø¦Ø±Ø© */
        .heart { position: fixed; font-size: 20px; color: var(--primary); z-index: 1000; pointer-events: none; animation: fly 6s linear infinite; }
        @keyframes fly { 0% { transform: translateY(100vh) scale(0); opacity: 1; } 100% { transform: translateY(-10vh) scale(1.5); opacity: 0; } }
    </style>
</head>
<body>

<div class="bg-animate"></div>

<div class="header">
    <img id="mainImg" src="" class="couple-img" style="display:none;">
    <h1>M & E</h1>
    <p style="font-size: 1.3rem; font-family: 'Lateef';">Ù„Ø­Ø¸Ø§ØªÙ†Ø§ Ø§Ù„Ø³Ø¹ÙŠØ¯Ø© ØªØ¨Ø¯Ø£ Ø¨ÙˆØ¬ÙˆØ¯ÙƒÙ…</p>
</div>

<div class="timer">
    <div class="unit"><span id="days">00</span>ÙŠÙˆÙ…</div>
    <div class="unit"><span id="hours">00</span>Ø³Ø§Ø¹Ø©</div>
    <div class="unit"><span id="minutes">00</span>Ø¯Ù‚ÙŠÙ‚Ø©</div>
    <div class="unit" onclick="adminAuth()" style="cursor:pointer"><span id="seconds">00</span>Ø«Ø§Ù†ÙŠØ©</div>
</div>

<div class="card">
    <h3 style="text-align: center;">Ø´Ø§Ø±ÙƒÙˆÙ†Ø§ ÙØ±Ø­ØªÙ†Ø§ â¤ï¸</h3>
    
    <div class="input-group">
        <input type="text" id="guestName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ±ÙŠÙ…">
    </div>

    <p style="font-weight: bold; font-size: 14px;">Ø£Ù†Øª Ù…Ù† Ø¶ÙŠÙˆÙ:</p>
    <div class="option-grid">
        <div class="choice" onclick="setSide(this, 'Ø§Ù„Ø¹Ø±ÙŠØ³')">ğŸ¤µ Ø§Ù„Ø¹Ø±ÙŠØ³</div>
        <div class="choice" onclick="setSide(this, 'Ø§Ù„Ø¹Ø±ÙˆØ³Ø©')">ğŸ‘° Ø§Ù„Ø¹Ø±ÙˆØ³Ø©</div>
    </div>

    <p style="font-weight: bold; font-size: 14px;">Ù‡Ù„ Ø³ØªØ´Ø±ÙÙ†Ø§ Ø¨Ø§Ù„Ø­Ø¶ÙˆØ±ØŸ</p>
    <select id="attendance">
        <option value="">Ø§Ø®ØªØ± Ø­Ø§Ù„ØªÙƒ...</option>
        <option value="Ø­Ø§Ø¶Ø±">Ø¨Ø¥Ø°Ù† Ø§Ù„Ù„Ù‡ Ø³Ø£ÙƒÙˆÙ† Ù…Ù† Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ†</option>
        <option value="ÙŠØ­Ø§ÙˆÙ„">Ø³Ø£Ø¨Ø°Ù„ Ù‚ØµØ§Ø±Ù‰ Ø¬Ù‡Ø¯ÙŠ Ù„Ù„ØªØ´Ø±ÙŠÙ</option>
        <option value="Ù…Ø¹ØªØ°Ø±">Ø£Ø¹ØªØ°Ø± Ù„Ø¸Ø±ÙˆÙ Ù‚Ù‡Ø±ÙŠØ©</option>
    </select>

    <div class="input-group" style="margin-top: 15px;">
        <textarea id="guestMsg" rows="3" placeholder="ØªÙ‡Ù†Ø¦Ø© Ù…Ù† Ø§Ù„Ù‚Ù„Ø¨..."></textarea>
    </div>

    <button onclick="submitInvite()" style="background: var(--primary); color: white; border: none; width: 100%; padding: 18px; border-radius: 15px; font-size: 1.2rem; cursor: pointer; box-shadow: 0 5px 15px rgba(255,133,162,0.4);">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‡Ù†Ø© ÙˆØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¶ÙˆØ±</button>

    <div id="guestBook" style="margin-top: 40px;"></div>
</div>

<div id="admin-panel">
    <h2 style="color: var(--primary);">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­ÙÙ„ Ø§Ù„Ù…Ù„ÙƒÙŠ</h2>
    
    <div class="stats-grid">
        <div class="stat-box" style="grid-column: span 2; background: var(--primary); color: white;"><h4>Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„Ø±Ø¯ÙˆØ¯</h4><p id="totalRes">0</p></div>
        <div class="stat-box"><h4>Ø¶ÙŠÙˆÙ Ø§Ù„Ø¹Ø±ÙŠØ³</h4><p id="groomGuests">0</p></div>
        <div class="stat-box"><h4>Ø¶ÙŠÙˆÙ Ø§Ù„Ø¹Ø±ÙˆØ³Ø©</h4><p id="brideGuests">0</p></div>
        <div class="stat-box" style="background: #d4edda;"><h4>ØªØ£ÙƒÙŠØ¯ Ø­Ø¶ÙˆØ±</h4><p id="absYes">0</p></div>
        <div class="stat-box" style="background: #fff3cd;"><h4>Ø³ÙŠØ­Ø§ÙˆÙ„ÙˆÙ†</h4><p id="absMaybe">0</p></div>
        <div class="stat-box" style="background: #f8d7da;"><h4>Ù…Ø¹ØªØ°Ø±ÙŠÙ†</h4><p id="absNo">0</p></div>
    </div>

    <hr>
    <h4>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h4>
    <input type="datetime-local" id="newDate">
    <input type="text" id="newImg" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø¹Ø±ÙˆØ³ÙŠÙ†">
    <button onclick="saveSettings()" style="background: var(--primary); color: white; border: none; padding: 10px; width: 100%; margin-top: 10px;">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    <button onclick="document.getElementById('admin-panel').style.display='none'" style="background: #666; color: white; border: none; padding: 10px; width: 100%; margin-top: 5px;">Ø¥ØºÙ„Ø§Ù‚</button>
    
    <div id="adminList" style="margin-top: 20px;"></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCF-kh6JgAbhroue7cKRdMZjwYV8m2c6Uw",
        authDomain: "engagmen.firebaseapp.com",
        databaseURL: "https://engagmen-default-rtdb.firebaseio.com",
        projectId: "engagmen",
        storageBucket: "engagmen.firebasestorage.app",
        messagingSenderId: "286100738965",
        appId: "1:286100738965:web:3f5be0307dca5927e5dc9c"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let guestSide = "";
    let targetTime = 0;

    function setSide(el, side) {
        document.querySelectorAll('.choice').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        guestSide = side;
    }

    db.ref('settings').on('value', s => {
        const v = s.val();
        if(v) {
            if(v.date) { targetTime = new Date(v.date).getTime(); document.getElementById('newDate').value = v.date; }
            if(v.image) { document.getElementById('mainImg').src = v.image; document.getElementById('mainImg').style.display = 'inline-block'; }
            else { document.getElementById('mainImg').style.display = 'none'; }
        }
    });

    setInterval(() => {
        const diff = targetTime - Date.now();
        if(diff <= 0) return;
        document.getElementById('days').innerText = Math.floor(diff/(1000*60*60*24));
        document.getElementById('hours').innerText = Math.floor((diff%(1000*60*60*24))/(1000*60*60));
        document.getElementById('minutes').innerText = Math.floor((diff%(1000*60*60))/(1000*60));
        document.getElementById('seconds').innerText = Math.floor((diff%(1000*60))/1000);
    }, 1000);

    function submitInvite() {
        const name = document.getElementById('guestName').value;
        const msg = document.getElementById('guestMsg').value;
        const att = document.getElementById('attendance').value;
        const now = new Date();
        const timeStr = now.toLocaleDateString('ar-EG') + " | " + now.toLocaleTimeString('ar-EG', {hour: '2-digit', minute:'2-digit'});

        if(name && guestSide && att) {
            db.ref('comments').push({
                name: name, msg: msg, side: guestSide, status: att, time: timeStr
            }).then(() => {
                alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ‡Ù†Ø¦ØªÙƒ Ù„Ø³ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ù‚ÙŠØ¨ Ø¨Ù†Ø¬Ø§Ø­ â¤ï¸");
                document.getElementById('guestName').value = "";
                document.getElementById('guestMsg').value = "";
            });
        } else { alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ø¬Ø§Ù†Ø¨ØŒ Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¶ÙˆØ±)"); }
    }

    db.ref('comments').on('value', s => {
        const list = document.getElementById('guestBook');
        const adm = document.getElementById('adminList');
        list.innerHTML = ""; adm.innerHTML = "<h4>ÙƒØ´Ù Ø§Ù„Ø¶ÙŠÙˆÙ:</h4>";
        
        let stats = { total: 0, groom: 0, bride: 0, yes: 0, maybe: 0, no: 0 };

        s.forEach(c => {
            const d = c.val();
            stats.total++;
            if(d.side === 'Ø§Ù„Ø¹Ø±ÙŠØ³') stats.groom++; else stats.bride++;
            if(d.status === 'Ø­Ø§Ø¶Ø±') stats.yes++; else if(d.status === 'Ù…Ø¹ØªØ°Ø±') stats.no++; else stats.maybe++;

            list.innerHTML += `<div class="comment">
                <b>${d.name}</b> <span class="badge">${d.side}</span> <br> ${d.msg}
                <div class="comment-info"><span>Ø§Ù„Ø­Ø§Ù„Ø©: ${d.status}</span> <span>${d.time}</span></div>
            </div>`;

            adm.innerHTML += `<div style="padding:10px; border-bottom:1px solid #eee;">
                <button onclick="db.ref('comments/${c.key}').remove()" style="background:red; color:white; border:none; border-radius:5px;">Ø­Ø°Ù</button>
                ${d.name} (${d.side}) - ${d.status}
            </div>`;
        });

        document.getElementById('totalRes').innerText = stats.total;
        document.getElementById('groomGuests').innerText = stats.groom;
        document.getElementById('brideGuests').innerText = stats.bride;
        document.getElementById('absYes').innerText = stats.yes;
        document.getElementById('absMaybe').innerText = stats.maybe;
        document.getElementById('absNo').innerText = stats.no;
    });

    let clicks = 0;
    function adminAuth() { clicks++; if(clicks>=10) { document.getElementById('admin-panel').style.display='block'; clicks=0; } }

    function saveSettings() {
        const d = document.getElementById('newDate').value;
        const i = document.getElementById('newImg').value;
        db.ref('settings').update({ date: d, image: i }).then(() => alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­"));
    }

    setInterval(() => {
        const heart = document.createElement('div');
        heart.className = 'heart'; heart.innerHTML = 'â¤ï¸';
        heart.style.left = Math.random() * 100 + 'vw';
        heart.style.animationDuration = (Math.random() * 3 + 3) + 's';
        document.body.appendChild(heart);
        setTimeout(() => heart.remove(), 6000);
    }, 800);
</script>
</body>
</html>
