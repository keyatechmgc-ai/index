<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M & E | Ù„ÙŠÙ„Ø© Ø´Ø¨ÙƒØªÙ†Ø§</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Dancing+Script:wght@700&family=Amiri:ital,wght@0,700;1,700&display=swap" rel="stylesheet">
    
    <style>
        :root { --soft-pink: #ffafbd; --deep-rose: #ff85a2; --gold: #d4af37; --text: #4a0e0e; }
        body { font-family: 'Cairo', sans-serif; background: #fffafb; margin: 0; color: var(--text); overflow-x: hidden; }

        /* ÙˆØ±Ø¯ ÙŠØªØ³Ø§Ù‚Ø· Ø¨Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ© */
        .petal { position: fixed; top: -10%; font-size: 20px; z-index: 999; pointer-events: none; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); opacity: 0; } }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨ */
        .header { text-align: center; padding: 40px 15px; background: #fff; border-bottom: 3px solid var(--soft-pink); border-radius: 0 0 50px 50px; }
        .couple-img { width: 180px; height: 180px; border-radius: 50%; border: 5px solid var(--soft-pink); object-fit: cover; margin-bottom: 15px; display: none; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        h1 { font-family: 'Dancing Script', cursive; font-size: 3rem; color: var(--deep-rose); margin: 5px 0; }
        
        /* Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¯Ù…Ø¬ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        .timer { display: flex; justify-content: center; gap: 8px; margin-top: -30px; }
        .unit { background: white; padding: 10px; border-radius: 15px; min-width: 60px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border: 1px solid var(--soft-pink); }
        .unit span { display: block; font-size: 20px; font-weight: bold; color: var(--deep-rose); }
        .unit label { font-size: 10px; color: #888; }

        /* Ø§Ù„ÙƒØ±ÙˆØª */
        .card { max-width: 90%; margin: 40px auto; background: white; padding: 20px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.03); border: 1px solid #ffeef1; }
        input, textarea, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 12px; border: 1px solid #eee; box-sizing: border-box; font-family: 'Cairo'; }
        
        /* Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹Ø±ÙŠØ³ ÙˆØ§Ù„Ø¹Ø±ÙˆØ³Ø© */
        .side-picker { display: flex; gap: 10px; margin: 10px 0; }
        .side-btn { flex: 1; padding: 10px; border: 2px solid var(--soft-pink); border-radius: 12px; cursor: pointer; text-align: center; font-weight: bold; transition: 0.3s; }
        .side-btn.active { background: var(--deep-rose); color: white; border-color: var(--deep-rose); }

        .btn-main { background: var(--deep-rose); color: white; border: none; padding: 15px; width: 100%; border-radius: 15px; font-size: 1.1rem; cursor: pointer; font-weight: bold; margin-top: 10px; }

        /* Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª */
        .comment { background: #fff5f7; padding: 15px; border-radius: 15px; margin-bottom: 15px; border-right: 5px solid var(--deep-rose); }
        .tag { font-size: 10px; padding: 2px 8px; border-radius: 8px; background: var(--soft-pink); color: white; margin-right: 5px; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© */
        #admin-panel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 10000; padding: 20px; overflow-y: auto; box-sizing: border-box; }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .stat-item { background: #fdf0f2; padding: 10px; border-radius: 10px; text-align: center; font-size: 12px; }
        .stat-item b { font-size: 18px; color: var(--deep-rose); display: block; }
        
        .filter-tabs { display: flex; border-bottom: 2px solid #eee; margin-bottom: 15px; }
        .tab { flex: 1; padding: 10px; text-align: center; cursor: pointer; font-weight: bold; color: #888; }
        .tab.active { color: var(--deep-rose); border-bottom: 3px solid var(--deep-rose); }
    </style>
</head>
<body>

<div class="header">
    <img id="mainImg" src="" class="couple-img">
    <h1>M & E</h1>
    <p style="font-family: 'Amiri', serif; font-size: 1.2rem;">Ù†Ù†ØªØ¸Ø±ÙƒÙ… Ù„ØªÙƒØªÙ…Ù„ Ø³Ø¹Ø§Ø¯ØªÙ†Ø§ â¤ï¸</p>
</div>

<div class="timer">
    <div class="unit"><span id="days">00</span><label>ÙŠÙˆÙ…</label></div>
    <div class="unit"><span id="hours">00</span><label>Ø³Ø§Ø¹Ø©</label></div>
    <div class="unit"><span id="minutes">00</span><label>Ø¯Ù‚ÙŠÙ‚Ø©</label></div>
    <div class="unit" onclick="adminAuth()" style="cursor:pointer"><span id="seconds">00</span><label>Ø«Ø§Ù†ÙŠØ©</label></div>
</div>

<div class="card">
    <input type="text" id="gName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ±ÙŠÙ…">
    <div class="side-picker">
        <div class="side-btn" onclick="selectSide(this, 'Ø§Ù„Ø¹Ø±ÙŠØ³')">ğŸ¤µ Ø§Ù„Ø¹Ø±ÙŠØ³</div>
        <div class="side-btn" onclick="selectSide(this, 'Ø§Ù„Ø¹Ø±ÙˆØ³Ø©')">ğŸ‘° Ø§Ù„Ø¹Ø±ÙˆØ³Ø©</div>
    </div>
    <select id="gStatus">
        <option value="">Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¶ÙˆØ±...</option>
        <option value="Ø­Ø§Ø¶Ø±">Ø³Ø£ÙƒÙˆÙ† Ù…Ù† Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ†</option>
        <option value="ÙŠØ­Ø§ÙˆÙ„">Ø³Ø£Ø¨Ø°Ù„ Ø¬Ù‡Ø¯ÙŠ Ù„Ù„ØªØ´Ø±ÙŠÙ</option>
        <option value="Ù…Ø¹ØªØ°Ø±">Ø£Ø¹ØªØ°Ø± Ù„Ø¸Ø±ÙˆÙ Ù‚Ù‡Ø±ÙŠØ©</option>
    </select>
    <textarea id="gMsg" rows="2" placeholder="ÙƒÙ„Ù…Ø© ØªÙ‡Ù†Ø¦Ø©..."></textarea>
    <button class="btn-main" onclick="sendData()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‡Ù†Ø©</button>
    
    <div id="publicList" style="margin-top: 30px;"></div>
</div>

<div id="admin-panel">
    <h3>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­ÙÙ„ Ø§Ù„Ù…Ù„ÙƒÙŠ</h3>
    <div class="stats-grid">
        <div class="stat-item">Ø§Ù„ÙƒÙ„<b id="sTotal">0</b></div>
        <div class="stat-item">Ø§Ù„Ø¹Ø±ÙŠØ³<b id="sGroom">0</b></div>
        <div class="stat-item">Ø§Ù„Ø¹Ø±ÙˆØ³Ø©<b id="sBride">0</b></div>
        <div class="stat-item" style="color:green">Ø­Ø§Ø¶Ø±<b id="sYes">0</b></div>
        <div class="stat-item" style="color:orange">ÙŠØ­Ø§ÙˆÙ„<b id="sTry">0</b></div>
        <div class="stat-item" style="color:red">Ù…Ø¹ØªØ°Ø±<b id="sNo">0</b></div>
    </div>

    <div class="filter-tabs">
        <div class="tab active" onclick="filterAdmin('Ø§Ù„ÙƒÙ„')">Ø§Ù„ÙƒÙ„</div>
        <div class="tab" onclick="filterAdmin('Ø§Ù„Ø¹Ø±ÙŠØ³')">Ø§Ù„Ø¹Ø±ÙŠØ³</div>
        <div class="tab" onclick="filterAdmin('Ø§Ù„Ø¹Ø±ÙˆØ³Ø©')">Ø§Ù„Ø¹Ø±ÙˆØ³Ø©</div>
    </div>
    <div id="adminList"></div>

    <hr>
    <input type="datetime-local" id="confDate">
    <input type="text" id="confImg" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø¹Ø±ÙˆØ³ÙŠÙ†">
    <button class="btn-main" onclick="saveConf()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    <button onclick="document.getElementById('admin-panel').style.display='none'" style="width:100%; padding:10px; margin-top:5px; border:none; background:#eee;">Ø®Ø±ÙˆØ¬</button>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCF-kh6JgAbhroue7cKRdMZjwYV8m2c6Uw",
        authDomain: "engagmen.firebaseapp.com",
        databaseURL: "https://engagmen-default-rtdb.firebaseio.com",
        projectId: "engagmen",
        storageBucket: "engagmen.firebasestorage.app",
        messagingSenderId: "286100738965",
        appId: "1:286100738965:web:3f5be0307dca5927e5dc9c"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let selectedSide = "";
    let targetDate = 0;
    let currentFilter = "Ø§Ù„ÙƒÙ„";

    function selectSide(el, s) {
        document.querySelectorAll('.side-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        selectedSide = s;
    }

    // Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    db.ref('settings').on('value', s => {
        const v = s.val();
        if(v) {
            if(v.date) { targetDate = new Date(v.date).getTime(); document.getElementById('confDate').value = v.date; }
            if(v.image) { document.getElementById('mainImg').src = v.image; document.getElementById('mainImg').style.display = 'inline-block'; }
            else { document.getElementById('mainImg').style.display = 'none'; }
        }
    });

    // Ø§Ù„Ø¹Ø¯Ø§Ø¯
    setInterval(() => {
        const diff = targetDate - Date.now();
        if(diff <= 0) return;
        document.getElementById('days').innerText = Math.floor(diff/(1000*60*60*24));
        document.getElementById('hours').innerText = Math.floor((diff%(1000*60*60*24))/(1000*60*60));
        document.getElementById('minutes').innerText = Math.floor((diff%(1000*60*60))/(1000*60));
        document.getElementById('seconds').innerText = Math.floor((diff%(1000*60))/1000);
    }, 1000);

    function sendData() {
        const n = document.getElementById('gName').value;
        const m = document.getElementById('gMsg').value;
        const st = document.getElementById('gStatus').value;
        const time = new Date().toLocaleString('ar-EG', {hour:'2-digit', minute:'2-digit', day:'numeric', month:'short'});
        if(n && selectedSide && st) {
            db.ref('comments').push({ name: n, msg: m, side: selectedSide, status: st, date: time });
            alert("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­ â¤ï¸");
            document.getElementById('gName').value = ""; document.getElementById('gMsg').value = "";
        } else { alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); }
    }

    db.ref('comments').on('value', s => {
        const pub = document.getElementById('publicList');
        pub.innerHTML = "";
        let st = { t:0, g:0, b:0, y:0, m:0, n:0 };
        const allData = [];

        s.forEach(c => {
            const d = c.val(); d.id = c.key;
            allData.push(d);
            st.t++;
            if(d.side === 'Ø§Ù„Ø¹Ø±ÙŠØ³') st.g++; else st.b++;
            if(d.status === 'Ø­Ø§Ø¶Ø±') st.y++; else if(d.status === 'Ù…Ø¹ØªØ°Ø±') st.n++; else st.m++;

            pub.innerHTML += `<div class="comment">
                <b>${d.name}</b> <span class="tag">${d.side}</span> <br> ${d.msg}
                <div style="font-size:10px; color:#999; margin-top:8px;">Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¶ÙˆØ±: ${d.status} | ${d.date}</div>
            </div>`;
        });

        document.getElementById('sTotal').innerText = st.t;
        document.getElementById('sGroom').innerText = st.g;
        document.getElementById('sBride').innerText = st.b;
        document.getElementById('sYes').innerText = st.y;
        document.getElementById('sTry').innerText = st.m;
        document.getElementById('sNo').innerText = st.n;
        window.cachedData = allData;
        renderAdminList();
    });

    function filterAdmin(f) {
        currentFilter = f;
        document.querySelectorAll('.tab').forEach(t => {
            t.classList.remove('active');
            if(t.innerText === f) t.classList.add('active');
        });
        renderAdminList();
    }

    function renderAdminList() {
        const adm = document.getElementById('adminList');
        adm.innerHTML = "";
        window.cachedData.forEach(d => {
            if(currentFilter === 'Ø§Ù„ÙƒÙ„' || d.side === currentFilter) {
                adm.innerHTML += `<div style="padding:10px; border-bottom:1px solid #eee; font-size:13px;">
                    <button onclick="db.ref('comments/${d.id}').remove()" style="background:red; color:white; border:none; padding:2px 8px; border-radius:5px; float:left;">Ø­Ø°Ù</button>
                    <b>${d.name}</b> (${d.status})<br><small>${d.date}</small>
                </div>`;
            }
        });
    }

    let clicks = 0;
    function adminAuth() { clicks++; if(clicks>=10) { document.getElementById('admin-panel').style.display='block'; clicks=0; } }
    function saveConf() {
        db.ref('settings').update({ date: document.getElementById('confDate').value, image: document.getElementById('confImg').value })
        .then(() => alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­"));
    }

    // ØªØ³Ø§Ù‚Ø· Ø§Ù„ÙˆØ±Ø¯ ÙˆØ§Ù„Ù‚Ù„ÙˆØ¨ Ø§Ù„Ù…Ø³ØªÙ…Ø±
    const icons = ['ğŸŒ¸', 'â¤ï¸', 'ğŸŒ¹', 'âœ¨'];
    setInterval(() => {
        const p = document.createElement('div');
        p.className = 'petal';
        p.innerHTML = icons[Math.floor(Math.random()*icons.length)];
        p.style.left = Math.random() * 100 + 'vw';
        p.style.animationDuration = (Math.random() * 3 + 4) + 's';
        document.body.appendChild(p);
        setTimeout(() => p.remove(), 7000);
    }, 500);
</script>
</body>
</html>
